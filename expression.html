<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expression Manager</title>
    <style>
        :root {
            --background-light: #fff;
            --background-dark: #121212;
            --background-button-hover-light:#b6b6b6;
            --background-button-hover-dark:#2c005e;
            --text-light: #000;
            --text-dark: #fff;
            --border-light: #ddd;
            --border-dark: #444;
        }
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-light);
            color: var(--text-light);
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        h2{
            margin: 0.5rem;
            font-size: 1rem;;
        }

        .container {
            display: flex;
            height: 100%;
            width: 100%;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            flex: 2; /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ */
            
        }

        .bottom-content {
            padding: 1rem;
            border-top: 1px solid var(--border-light);
            background-color: var(--background-light);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
            height: 20%; /* –ù–∞—á–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        }

        body.dark .bottom-content {
            border-top: 1px solid var(--border-dark);
            background-color: var(--background-dark);
        }

        .resize-handle-horizontal {
            position: absolute;
            top: -5px;
            left: 0;
            right: 0;
            height: 10px;
            cursor: row-resize;
            background: transparent;
        }

        body.dark #fileNameInput {
            background-color: var(--background-dark);
            color:var(--text-dark);
        }

        .side-content {
            padding: 0.3rem;
            border-left: 1px solid var(--border-light);
            background-color: var(--background-light);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
            width: 20%; /* –ù–∞—á–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
        }

        body.dark .side-content {
            border-left: 1px solid var(--border-dark);
            background-color: var(--background-dark);
        }

        .resize-handle-vertical {
            position: absolute;
            top: 0;
            left: -5px;
            bottom: 0;
            width: 10px;
            cursor: col-resize;
            background: transparent;
        }

        .box {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }

        textarea {
            flex: 1;
            width: 97%;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 1rem;
            font-size: 1rem;
            outline: none;
            resize: none;
            margin: 0;
        }

        textarea:focus {
            border-color: #6666CC;
            box-shadow: 0 0 5px rgba(0, 58, 120, 0.5);
        }

        #resultOutput {
            padding: 1rem;
            font-size: 1rem;
            font-family: 'Courier New', Courier, monospace;
            background-color: #f9f9f9;
            overflow-y: auto;
            height: 10vh;
        }

        textarea, #resultOutput {
            background-color: var(--background-light);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        body.dark textarea, body.dark #resultOutput {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        .instrumentcont {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0rem;
        }

        button {
            background: var(--background-light);
            color: var(--text-light);
            border: none;
            padding: 0.1rem 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s, transform 0.2s;
        }

        body.dark button {
            background: var(--background-dark);
            color: var(--text-dark);
        }

        button:hover {
            background-color: var(--background-button-hover-light);
            transform: scale(1.05);
        }
        body.dark button:hover{
            background-color: var(--background-button-hover-dark);
            transform: scale(1.05); 
        }

        button:active {
            transform: scale(1);
        }

    

        .saved-expression {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: var(--background-light);
            color: var(--text-light);
            border: 1px solid var(--border-light);
            border-radius: 5px;
        }

        body.dark .saved-expression {
            background-color: var(--background-dark);
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
        }
        
        .saved-expression span {
            word-break: break-word;
            white-space: pre-wrap;
            max-height: 3.5rem; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã */
            overflow: hidden;
            text-overflow: ellipsis;
            display: inline-block;
        }


        .saved-expression button {
            background: var(--background-light);
            color: var(--text-light);
            border: none;
            margin-left: auto;
            border-radius: 5px;
            padding: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
        }


        .saved-expression button:hover {
            background: #b6b6b6;
        }

        #savedExpressions {
            flex: 1;
            overflow-y: auto;
        }

        #savedExpressions::-webkit-scrollbar {
            width: 5px;
        }

        #savedExpressions::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 5px;
        }

        #savedExpressions::-webkit-scrollbar-thumb:hover {
            background: #bbb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <!-- Input Section -->
            <div class="box">
                <!-- –ü–æ–ª–µ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ -->
                
                <div class="instrumentcont">
                    <button onclick="runExpression()">üü¢</button>
                    <button onclick="saveExpression()">üíæ</button>
                    <button onclick="toggleVisibility('resultBox')">Result</button>
                    <button onclick="toggleVisibility('savedBox')">Saved</button>
                    <button onclick="toggleTheme()">üåì</button>
                </div>
                <input type="text" id="fileNameInput" placeholder="Enter file name..." maxlength="50">
                <textarea id="expressionInput" placeholder="Enter your expression here..."></textarea>
                <div class="bottom-content" id="resultBox">
                    <div class="resize-handle-horizontal" id="resizeHorizontal"></div>
                    <div id="resultOutput" readonly></div>
                </div>
            </div>
        </div>

        <!-- Saved Expressions -->
        <div class="side-content" id="savedBox">
            <div class="resize-handle-vertical" id="resizeVertical"></div>
            <h2>Saved Files</h2>
            <div id="savedExpressions"></div>
        </div>
    </div>

    <script>
        function toggleTheme() {
                document.body.classList.toggle('dark');
            }
            //–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
            async function fetchFileByName(fileName) {
                const requestOptions = {
                    method: "GET",
                    redirect: "follow",
                };

                fetch(`http://127.0.0.1:5000/get/${fileName}`, requestOptions)
                    .then((response) => response.json())
                    .then((result) => {
                        console.log("File content:", result);
                        document.getElementById("fileNameInput").value = result.name;
                        document.getElementById("expressionInput").value = result.text;
                    })
                    .catch((error) => console.error("Error fetching file:", error));
            }


        //–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ–ª–µ–π Save –∏ Result
        const bottomContent = document.getElementById('resultBox');
        const resizeHorizontal = document.getElementById('resizeHorizontal');
        const sideContent = document.getElementById('savedBox');
        const resizeVertical = document.getElementById('resizeVertical');

        let isResizingHorizontal = false;
        let isResizingVertical = false;

        //–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ up/down
        resizeHorizontal.addEventListener('mousedown', (e) => {
            isResizingHorizontal = true;
            document.body.style.cursor = 'row-resize';
            document.addEventListener('mousemove', resizeBottomContent);
            document.addEventListener('mouseup', stopResizingHorizontal);
        });

        function resizeBottomContent(e) {
            if (!isResizingHorizontal) return;
            const containerRect = bottomContent.parentElement.getBoundingClientRect();
            const newHeight = containerRect.bottom - e.clientY;
            bottomContent.style.height = `${newHeight}px`;
        }

        function stopResizingHorizontal() {
            isResizingHorizontal = false;
            document.body.style.cursor = 'default';
            document.removeEventListener('mousemove', resizeBottomContent);
            document.removeEventListener('mouseup', stopResizingHorizontal);
        }

        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ left/right
        resizeVertical.addEventListener('mousedown', (e) => {
            isResizingVertical = true;
            document.body.style.cursor = 'col-resize';
            document.addEventListener('mousemove', resizeSideContent);
            document.addEventListener('mouseup', stopResizingVertical);
        });

        function resizeSideContent(e) {
            if (!isResizingVertical) return;
            const containerRect = sideContent.parentElement.getBoundingClientRect();
            const newWidth = containerRect.right - e.clientX;
            sideContent.style.width = `${newWidth}px`;
        }

        function stopResizingVertical() {
            isResizingVertical = false;
            document.body.style.cursor = 'default';
            document.removeEventListener('mousemove', resizeSideContent);
            document.removeEventListener('mouseup', stopResizingVertical);
        }

        //
        document.addEventListener("DOMContentLoaded", () => {
            fetchAllFiles(); // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
        });

        const savedExpressions = [];
        let editIndex = null; // –£–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

        //–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
        async function fetchAllFiles() {
            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            const requestOptions = {
                method: "GET",
                headers: myHeaders,
                redirect: "follow",
            };

            try {
                const response = await fetch("http://127.0.0.1:5000/getall", requestOptions);
                const result = await response.json();
                savedExpressions.length = 0; // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
                savedExpressions.push(...result["result"]); // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
                updateSavedExpressions();
            } catch (error) {
                console.error("Error fetching files:", error);
            }
        }

        //–ó–∞–ø—É—Å–∫ —Ñ–∞–π–ª–∞
        async function runExpression(expression = null) {
            const resultOutput = document.getElementById("resultOutput");
            const timestamp = new Date().toLocaleString();
            const input = expression || document.getElementById("expressionInput").value.trim();

            if (input === "") {
                resultOutput.innerHTML += `<div>${timestamp} Error: Expression is empty.</div>`;
                return;
            }

            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            const raw = JSON.stringify({ expression: input });

            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: raw,
            };

            try {
                const response = await fetch("http://127.0.0.1:5000/process", requestOptions);
                const result = await response.json();
                console.log(result)
                resultOutput.innerHTML += `<div>${timestamp}: ${result.result}</div>`;
            } catch (error) {
                resultOutput.innerHTML += `<div>${timestamp} Error: ${error.message}</div>`;
                console.error("Error evaluating expression:", error);
            }
        }

        //–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        async function saveExpression() {
            const fileNameInput = document.getElementById("fileNameInput").value.trim();
            const expressionInput = document.getElementById("expressionInput").value.trim();
            const timestamp = new Date().toLocaleString();

            if (fileNameInput === "" || expressionInput === "") {
                alert("File name and expression cannot be empty.");
                return;
            }

            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            const raw = JSON.stringify({
                name: fileNameInput,
                text: expressionInput,
                timestamp: timestamp,
            });

            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: raw,
            };

            try {
                await fetch("http://127.0.0.1:5000/save", requestOptions);
                fetchAllFiles(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
                document.getElementById("fileNameInput").value = "";
                document.getElementById("expressionInput").value = "";
            } catch (error) {
                console.error("Error saving file:", error);
            }
        }

        //–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        async function deleteExpression(index) {
            const fileName = savedExpressions[index].name;

            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            const raw = JSON.stringify({ name: fileName });

            const requestOptions = {
                method: "DELETE",
                headers: myHeaders,
                body: raw,
            };

            try {
                await fetch("http://127.0.0.1:5000/delete", requestOptions);
                fetchAllFiles(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
            } catch (error) {
                console.error("Error deleting file:", error);
            }
        }

        //–í—ã–≤–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        function updateSavedExpressions() {
            const container = document.getElementById("savedExpressions");
            container.innerHTML = ""; 
            savedExpressions.forEach((item, index) => {
                const div0 = document.createElement("div");
    
                const div = document.createElement("div");
                div.className = "saved-expression";

                div0.className = "saved-expression1";
                div0.style.flexDirection = "column";
                div0.style.border = "none";
                div0.style.alignItems = "left";
                const nameSpan = document.createElement("span");
                nameSpan.textContent = item.name;

                const timestampDiv = document.createElement("div");
                timestampDiv.style.fontSize = "0.8rem";
                timestampDiv.style.color = "#666";
                timestampDiv.style.marginTop = "0.5rem"; 
                timestampDiv.textContent = item.timestamp;

                const div1 = document.createElement("div");
 

                const editButton = document.createElement("button");
                editButton.textContent = "‚úèÔ∏è";
                editButton.onclick = () => fetchFileByName(item.name);

                const deleteButton = document.createElement("button");
                deleteButton.textContent = "üóëÔ∏è";
                deleteButton.onclick = () => deleteExpression(index);

                div0.appendChild(nameSpan); 
                div0.appendChild(timestampDiv); 
                div1.appendChild(editButton); 
                div1.appendChild(deleteButton);
                div.appendChild(div0);
                div.appendChild(div1);
                container.appendChild(div);
            });
        }

        function toggleVisibility(sectionId) {
            const section = document.getElementById(sectionId);
            if (section.style.display === "none") {
                section.style.display = "flex";
            } else {
                section.style.display = "none";
            }
        }


        
    </script>
</body>
</html>
